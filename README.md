# Free convection modeled using a neural differential equation

This directory contains scripts for training and testing a neural differential equation for modeling oceanic free convection.

## Data generation

The training (truth) data is generated by Oceananigans.jl simulating high-resolution 3D oceanic boundary layer turbulence using large-eddy simulation. The training data can be generated by running the `free_convection_les.jl` script (it might take a few hours to run a simulation on a good GPU).

## Data exploration

The training data is visualized and animated in the `animate_free_convection_les_data.jl` script. It's good to have a look at the data first before attempting to train on it!

## Training the neural network

In `train_neural_network.jl` a neural network is trained to learn the mapping between temperature profiles T(z) and turbulent vertical heat flux profiles w'T'(z). The neural network is then saved to disk.

The purpose of this step is to get an initial guess for the weights of the neural network before attempting to embed it within a neural differential equation (which blows up due to numerical instabilities introduced by random initial weights). So the neural network doesn't have to be trained much to serve as an appropriate initial guess.

## Training the neural differential equation

In `train_neural_differential_equation.jl` the neural network is then embedded within a differential equation and trained to learn the time evolution of the PDE

```math
∂T/∂t = - ∂/∂z(wT).
```

Alternatively, in `train_convective_adjustment_nde.jl`

## Testing the neural differential equation

`test_neural_differential_equation.jl`

## Embedding the trained neural network into Oceananigans.jl

`oceananigans_nn.jl`

## Embedding the trained neural network into a baroclinic gyre simulation

`baroclinic_gyre_nn.jl`
